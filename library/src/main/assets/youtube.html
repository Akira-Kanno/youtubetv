<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=1920">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <title></title>
    <style type="text/css">
    #over {
        position: absolute;
        top: 50%;
        left: 50%;
        z-index: 1000;
        border: 2px solid black;
        pointer-events: none;
    }
    
    iframe {
        position: absolute;
        border: none;
        box-sizing: border-box;
        width: 100%;
        height: 100%;
    }
    
    img {
        min-height: 100%;
        min-width: 100%;
        height: auto;
        width: auto;
        position: absolute;
        top: -100%;
        bottom: -100%;
        left: -100%;
        right: -100%;
        margin: auto;
    }
    </style>
    <script>
    var QueryString = function() {
        // This function is anonymous, is executed immediately and 
        // the return value is assigned to QueryString!
        var query_string = {};
        var query = window.location.search.substring(1);
        var vars = query.split("&");
        for (var i = 0; i < vars.length; i++) {
            var pair = vars[i].split("=");
            // If first entry with this name
            if (typeof query_string[pair[0]] === "undefined") {
                query_string[pair[0]] = decodeURIComponent(pair[1]);
                // If second entry with this name
            } else if (typeof query_string[pair[0]] === "string") {
                var arr = [query_string[pair[0]], decodeURIComponent(pair[1])];
                query_string[pair[0]] = arr;
                // If third or later entry with this name
            } else {
                query_string[pair[0]].push(decodeURIComponent(pair[1]));
            }
        }
        return query_string;
    }();

    $(document).ready(function() {
        $("#thumbnail_picture").attr('src', 'https://img.youtube.com/vi/' + QueryString.videoId + '/maxresdefault.jpg');
    });

    var player, iframe;
    var debug = true;
    var timerId = 0;
    /**
     * Log message if debug is configured.
     * 
     * @param  {string} header message
     * @param  {string} log message
     */
    function log(header, message) {
        if (debug) {
            window.JSInterface.log("[ JS - " + header + " ]", message);
        }
    }

    // init player
    function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
            height: QueryString.playerHeight,
            width: QueryString.playerWidth,
            suggestedQuality: QueryString.videoQuality,
            playerVars: {
                rel: QueryString.rel,
                showinfo: QueryString.showinfo,
                controls: QueryString.controls,
                autohide: QueryString.autohide,
                cc_load_policy: QueryString.cc_load_policy,
                iv_load_policy: QueryString.iv_load_policy
            },
            events: {
                'onReady': onPlayerReady,
                'onStateChange': onPlayerStateChange
            }
        });

    }

    function loadVideo(target) {
        target.loadVideoById(QueryString.videoId, 0, QueryString.videoQuality);
    }

    function onPlayerStateChange(event) {

        var playbackQuality = event.target.getPlaybackQuality();
        var suggestedQuality = QueryString.videoQuality;

        log(onPlayerStateChange.name, "Quality changed to: " + playbackQuality);

        if (playbackQuality !== QueryString.videoQuality) {
            log(onPlayerStateChange.name, "Setting quality to " + suggestedQuality);
            event.target.setPlaybackQuality(suggestedQuality);
        }

        switch (event.data) {
            case YT.PlayerState.ENDED:
                log(onPlayerStateChange.name, "state changed to YT.PlayerState.ENDED");
                break;
            case YT.PlayerState.PLAYING:
                clearInterval(timerId);
                log(onPlayerStateChange.name, "state changed to YT.PlayerState.PLAYING");
                break;
            case YT.PlayerState.PAUSED:
                log(onPlayerStateChange.name, "state changed to YT.PlayerState.PAUSED");
                break;
            case YT.PlayerState.BUFFERING:
                log(onPlayerStateChange.name, "state changed to YT.PlayerState.BUFFERING");
                break;
            case YT.PlayerState.CUED:
                log(onPlayerStateChange.name, "state changed to YT.PlayerState.CUED");
                break;
            default:
                log(onPlayerStateChange.name, "state changed to " + event.data);
                break;
        }

        //window.JSInterface.log(event.data);
    }

    /**
     * Plays the currently cued/loaded video.
     */
    function playVideo() {
        player.playVideo();
    }

    /**
     * Pauses the currently playing video.
     */
    function pauseVideo() {
        player.pauseVideo();
    }

    /**
     * Stops and cancels loading of the current video.
     */
    function stopVideo() {
        player.stopVideo();
    }

    /**
     * Seeks to a specified time in the video.
     * 
     * @param  {number} identifies the time to which the player should advance
     * @param  {boolean} determines whether the player will make a new request to the server if the seconds parameter specifies a time outside of the currently buffered video data
     */
    function seekTo(seconds, allowSeekAhead) {
        player.seekTo(seconds, allowSeekAhead);
    }

    /**
     * Loads and plays the next video in the playlist.
     */
    function nextVideo() {
        player.nextVideo();
    }

    /**
     * Loads and plays the previous video in the playlist.
     */
    function previousVideo() {
        player.previousVideo();
    }

    /**
     * Loads and plays the specified video in the playlist.
     * 
     * @param  {number} playlist index
     */
    function playVideoAt(index) {
        player.playVideoAt(index);
    }

    /**
     * Mute player.
     */
    function mute() {
        player.mute();
    }

    /**
     * Unmute player.
     */
    function unMute() {
        player.unMute();
    }

    /**
     * Check if player is muted.
     * 
     * @return {boolean} true if the player is muted, false if not
     */
    function isMuted() {
        return player.isMuted();
    }

    /**
     * Set volume
     * 
     * @param {number} volume value between 0 and 100
     */
    function setVolume(volume) {
        player.setVolume(volume);
    }

    /**
     * Returns the player's current volume, an integer between 0 and 100.
     *  
     * @return {number} volume between 0 and 100
     */
    function getVolume() {
        return player.getVolume();
    }

    /**
     * Sets the size in pixels of the <iframe> that contains the player.
     * 
     * @param {number} width value
     * @param {number} heigth value
     */
    function setSize(width, heigth) {
        player.setSize(width, heigth);
    }

    /**
     * Retrieves the playback rate of the currently playing video.
     * 
     * @return {number} playback rate
     */
    function getPlaybackRate() {
        return player.getPlaybackRate();
    }

    /**
     * Set the playback rate.
     * 
     * @param {number} the suggested playback rate for the current video
     */
    function setPlaybackRate(suggestedRate) {
        player.setPlaybackRate(suggestedRate);
    }

    /**
     * List of playback rates in which the current video is available. 
     * 
     * @return {string} the set of playback rates in which the current video is available. The default value is 1, which indicates that the video is playing in normal speed
     */
    function getAvailablePlaybackRates() {
        return JSON.stringify(player.getAvailablePlaybackRates());
    }

    /**
     * Loop the playlist or not.
     * 
     * @param {boolean} indicates whether the video player should continuously play a playlist or if it should stop playing after the last video in the playlist ends
     */
    function setLoop(loopPlaylists) {
        player.loopPlaylists(loopPlaylists);
    }

    /**
     * Shuffle the playlist or not.
     * 
     * @param {boolean}  indicates whether a playlist's videos should be shuffled so that they play back in an order different from the one that the playlist creator designated.
     */
    function setShuffle(shufflePlaylist) {
        player.setShuffle(shufflePlaylist);
    }

    /**
     * Get video loaded fraction.
     * 
     * @return {number} a number between 0 and 1 that specifies the percentage of the video that the player shows as buffered
     */
    function getVideoLoadedFraction() {
        return player.getVideoLoadedFraction();
    }

    /**
     * Get current player state.
     * 
     * @return {number} state of the player
     */
    function getPlayerState() {
        return player.getPlayerState();
    }

    /**
     * Get time since video is playing.
     * 
     * @return {number} elapsed time in seconds since the video started playing
     */
    function getCurrentTime() {
        return player.getCurrentTime();
    }

    /**
     * Set the suggested video quality for the current video.
     * 
     * @param {string} video quality
     */
    function setPlaybackQuality(suggestedQuality) {
        player.setPlaybackQuality(suggestedQuality);
    }

    /**
     * Get current video quality.
     * 
     * @return {string} the actual video quality of the current video
     */
    function getPlaybackQuality() {
        return player.getPlaybackQuality();
    }

    /**
     * Get all available quality levels.
     * 
     * @return {string} the set of quality formats in which the current video is available
     */
    function getAvailableQualityLevels() {
        return player.getAvailableQualityLevels();
    }

    /**
     * Get duration.
     * 
     * @return {number} the duration in seconds of the currently playing video
     */
    function getDuration() {
        return player.getDuration();
    }

    /**
     * Get video URL.
     * 
     * @return {string}  the YouTube.com URL for the currently loaded/playing video
     */
    function getVideoUrl() {
        return player.getVideoUrl();
    }

    /**
     * Get video embed code.
     * 
     * @return {string} the embed code for the currently loaded/playing video
     */
    function getVideoEmbedCode() {
        return player.getVideoEmbedCode();
    }

    /**
     * Get playlist.
     * 
     * @return {string} an array of the video IDs in the playlist as they are currently ordered
     */
    function getPlaylist() {
        return JSON.stringify(player.getPlaylist());
    }

    /**
     * Get playlist index.
     * 
     * @return {number} returns the index of the playlist video that is currently playing
     */
    function getPlaylistIndex() {
        return player.getPlaylistIndex();
    }

    // when ready, wait for clicks
    function onPlayerReady(event) {

        event.target.setPlaybackQuality(QueryString.videoQuality);
        var player = event.target;
        iframe = document.getElementById('player');

        log(onPlayerReady.name, "before loadVideo");
        loadVideo(player);
        $("#thumbnail").css("display", "none");
        $("#video_div").css("display", "block");
        timerId = setInterval(function() {
            log(onPlayerReady.name, "trying to start video...");
            window.JSInterface.startVideo();
        }, 1000);
        return false;
    }
    </script>
</head>

<body id="body" style='margin:0;padding:0;'>
    <div id="thumbnail">
        <img id="thumbnail_picture" />
    </div>
    <div id="video_div" style='display:none;'>
        <script src="https://www.youtube.com/iframe_api"></script>
        <div id="bottom">
            <div id="player"></div>
        </div>
    </div>
</body>

</html>
